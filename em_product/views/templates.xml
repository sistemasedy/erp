<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="product_template_tree_view_em" model="ir.ui.view">
        <field name="name">product.template.product.tree.em</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_tree_view"/>
        <field name="arch" type="xml">
            <xpath expr="//tree" position="inside">
                <field name="standard_price" widget='monetary' options="{'currency_field': 'cost_currency_id'}" optional="show"/>
                <field name="barcode"/>
                <field name="calcular_venta"/>
                <field name="margen"/>
                <field name="margen_valor"/>
                <field name="seller_ids" widget="many2many_tags"/>
                <field name="default_code" invisible="1"/>
                <field name="taxes_id"  widget="many2many_tags"/>
                <field name="supplier_taxes_id" widget="many2many_tags"/>
                <field name="company_id" invisible="1"/>
                <field name="available_in_pos"/>
                
            </xpath>
            <xpath expr="//tree" position="attributes">
              <attribute name="editable">bottom</attribute>
            </xpath>
        </field>
            
    </record>

    <record id="product_template_form_view_em" model="ir.ui.view">
        <field name="name">product.template.common.form.em</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_form_view"/>
        <field name="arch" type="xml">

            <xpath expr="//page[@name='sales']" position="after">
                <page name="calculo_precio" string="Calculo de Precio">

                            <group>
                               
                                <group name="precios_valores">
                                    <field name="calcular_venta"/>
                                    <field name="calcular_costo"/>

                                    <field name="list_price"/>
                                    <field name="margen"/>
                                    
                                    <label for="standard_price" groups="base.group_user"/>
                                    <div name="standard_price_uom" groups="base.group_user">
                                        <field name="standard_price" widget="monetary" options="{'currency_field': 'currency_id'}" class="oe_inline"/>
                                    </div>
                                </group>
                            </group>
                    
                </page>
            </xpath>
            <xpath expr="//field[@name='detailed_type']" position="after">
                <field name="fecha_de_vencimiento"/>
                <field name="grupo"/>
            </xpath>

           

        </field>
    </record>



    <record id="product_template_margin_form_view" model="ir.ui.view">
        <field name="name">product.template.margin.form</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_form_view"/>
        <field name="arch" type="xml">
            <!--
            Agregamos un nuevo grupo después del grupo de precios para nuestra lógica.
            Esto mantiene la interfaz organizada.
            -->
            <xpath expr="//group[@name='group_standard_price']" position="after">
                <group name="group_margin_calculation" string="Cálculos de Precio y Margen">
                    <field name="calculation_mode"/>
                    <!--
                    El campo para fijar el margen solo es visible si el modo es 'margin_to_price'.
                    Se usa el widget de porcentaje para una mejor visualización.
                    -->
                    <field name="fixed_margin"
                        widget="percentage"
                        attrs="{'invisible': [('calculation_mode', '!=', 'margin_to_price')]}"/>
                    <!--
                    El campo de margen calculado solo es visible si el modo es 'price_to_margin'.
                    Es de solo lectura porque se calcula automáticamente.
                    -->
                    <field name="product_margin"
                        widget="percentage"
                        readonly="1"
                        attrs="{'invisible': [('calculation_mode', '!=', 'price_to_margin')]}"/>
                </group>
            </xpath>

            <!--
            Hacemos que el campo de Precio de Venta sea de solo lectura si se calcula desde el margen,
            para evitar que el usuario lo edite manualmente y rompa la lógica del onchange.
            -->
            <xpath expr="//field[@name='list_price']" position="attributes">
                <attribute name="attrs">{'readonly': [('calculation_mode', '=', 'margin_to_price')]}</attribute>
            </xpath>
        </field>
    </record>





    <record id="view_product_filter_february_custom" model="ir.ui.view">
        <field name="name">product.template.search.february</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_search_view"/>
        <field name="arch" type="xml">
            <xpath expr="//search" position="inside">
                <separator/>
                <filter string="Creados desde Febrero" 
                        name="created_from_february" 
                        domain="[('create_date', '>=', '2025-02-10')]"/>
                <filter string="Creados este mes" 
                        name="created_this_month"
                        domain="[('create_date', '>=', (context_today() + relativedelta(day=1)).strftime('%Y-%m-%d'))]"/>
                <filter string="Creados el mes pasado"
                        name="created_last_month"
                        domain="[
                            ('create_date', '>=', (context_today() + relativedelta(months=-1, day=1)).strftime('%Y-%m-%d')),
                            ('create_date', '&lt;', (context_today() + relativedelta(day=1)).strftime('%Y-%m-%d'))
                        ]"/>
            </xpath>
        </field>
    </record>

    


</odoo>